{"title":"Java.ä»£ç†æ¨¡å¼(Proxy)","slug":"sprouting180413","date":"2018-04-13T02:30:30.000Z","updated":"2018-04-13T06:45:55.000Z","comments":true,"path":"api/articles/sprouting180413.json","photos":[],"link":"","excerpt":null,"covers":null,"content":"<p></p><p style=\"text-align: center;\">â¤</p><p></p>\n<h3 id=\"ä»£ç†æ¨¡å¼æ˜¯ä»€ä¹ˆï¼Ÿ\"><a href=\"#ä»£ç†æ¨¡å¼æ˜¯ä»€ä¹ˆï¼Ÿ\" class=\"headerlink\" title=\"ä»£ç†æ¨¡å¼æ˜¯ä»€ä¹ˆï¼Ÿ\"></a>ä»£ç†æ¨¡å¼æ˜¯ä»€ä¹ˆï¼Ÿ</h3><blockquote>\n<p>ä»£ç†(Proxy)æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œæä¾›äº†å¯¹ç›®æ ‡å¯¹è±¡å¦å¤–çš„è®¿é—®æ–¹å¼ï¼›å³é€šè¿‡ä»£ç†å¯¹è±¡è®¿é—®ç›®æ ‡å¯¹è±¡ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼šå¯ä»¥åœ¨ç›®æ ‡å¯¹è±¡å®ç°çš„åŸºç¡€ä¸Šï¼Œå¢å¼ºé¢å¤–çš„åŠŸèƒ½æ“ä½œï¼Œå³æ‰©å±•ç›®æ ‡å¯¹è±¡çš„åŠŸèƒ½ã€‚</p>\n<p>è¿™é‡Œä½¿ç”¨åˆ°ç¼–ç¨‹ä¸­çš„ä¸€ä¸ªæ€æƒ³ï¼šä¸è¦éšæ„å»ä¿®æ”¹åˆ«äººå·²ç»å†™å¥½çš„ä»£ç æˆ–è€…æ–¹æ³•ï¼Œå¦‚æœéœ€æ”¹ä¿®æ”¹ï¼Œå¯ä»¥é€šè¿‡ä»£ç†çš„æ–¹å¼æ¥æ‰©å±•è¯¥æ–¹æ³•</p>\n</blockquote>\n<p><br></p>\n<h3 id=\"é™æ€ä»£ç†\"><a href=\"#é™æ€ä»£ç†\" class=\"headerlink\" title=\"é™æ€ä»£ç†\"></a>é™æ€ä»£ç†</h3><blockquote>\n<p>é™æ€ä»£ç†åœ¨ä½¿ç”¨æ—¶,éœ€è¦å®šä¹‰æ¥å£æˆ–è€…çˆ¶ç±»,è¢«ä»£ç†å¯¹è±¡ä¸ä»£ç†å¯¹è±¡ä¸€èµ·å®ç°ç›¸åŒçš„æ¥å£æˆ–è€…æ˜¯ç»§æ‰¿ç›¸åŒçˆ¶ç±».</p>\n<ul>\n<li>å®ç°æ€è·¯<ol>\n<li>åˆ›å»ºå…¬å…±çˆ¶ç±»æˆ–æ¥å£ï¼Œä½¿ä»£ç†äººå’Œè¢«ä»£ç†äººå…·æœ‰å…¬å…±æ–¹æ³•</li>\n<li>ä»£ç†ç±»ä¸­è®¾ç½®æ–¹æ³•è·å–è¢«ä»£ç†å¯¹è±¡</li>\n<li>ä»£ç†ç±»ä¸­é‡å†™è¢«ä»£ç†ç±»ä¸­éœ€è¦è¢«æ‰©å±•æˆ–æ›´æ”¹çš„æ–¹æ³•</li>\n<li>åº”ç”¨æ—¶ï¼Œå°†è¢«ä»£ç†å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ç»™ä»£ç†å¯¹è±¡ï¼Œå®Œæˆä»£ç†</li>\n</ol>\n</li>\n</ul>\n</blockquote>\n<ul>\n<li>ä»£ç éƒ¨åˆ†<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Part.1</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">IUserDao</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Part.2 and .3</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserDao</span> <span class=\"keyword\">implements</span> <span class=\"title\">IUserDao</span></span>&#123;</span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// TODO Auto-generated method stub</span></span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"Run as 10km/h! Too slow!\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">UserDaoProxy</span> <span class=\"keyword\">implements</span> <span class=\"title\">IUserDao</span></span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// ç”¨çˆ¶ç±»æˆ–æ¥å£æ¥æ¥å—å¯¹è±¡ï¼Œé™ä½è€¦åˆåº¦</span></span><br><span class=\"line\">    <span class=\"keyword\">private</span> IUserDao target;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">UserDaoProxy</span><span class=\"params\">(IUserDao target)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.target = target;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"meta\">@Override</span></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        target.run();</span><br><span class=\"line\">        System.out.println(<span class=\"string\">\"Propxy high up the speed to 20km/h! Fine!\"</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Part.4</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">    UserDaoProxy proxy = <span class=\"keyword\">new</span> UserDaoProxy(<span class=\"keyword\">new</span> UserDao());</span><br><span class=\"line\">        proxy.run();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><br></p>\n<h3 id=\"åŠ¨æ€ä»£ç†ï¼ˆJDKä»£ç†ã€æ¥å£ä»£ç†ï¼‰\"><a href=\"#åŠ¨æ€ä»£ç†ï¼ˆJDKä»£ç†ã€æ¥å£ä»£ç†ï¼‰\" class=\"headerlink\" title=\"åŠ¨æ€ä»£ç†ï¼ˆJDKä»£ç†ã€æ¥å£ä»£ç†ï¼‰\"></a>åŠ¨æ€ä»£ç†ï¼ˆJDKä»£ç†ã€æ¥å£ä»£ç†ï¼‰</h3><blockquote>\n<p>åŠ¨æ€ä»£ç†çš„ä»£ç†å¯¹è±¡ä¸éœ€è¦å®ç°æ¥å£ï¼Œå®ƒæ˜¯é€šè¿‡JDKçš„APIï¼ŒåŠ¨æ€çš„åœ¨å†…å­˜ä¸­æ„å»ºä»£ç†å¯¹è±¡(éœ€è¦æˆ‘ä»¬æŒ‡å®šåˆ›å»ºä»£ç†å¯¹è±¡ï¼ç›®æ ‡å¯¹è±¡å®ç°çš„æ¥å£çš„ç±»å‹)</p>\n<p>åŠ¨æ€ä»£ç†ä¸­ç”¨åˆ°äº†invoke()ï¼Œè¿™æ˜¯åå°„æ–¹é¢çš„çŸ¥è¯†ï¼Œå¦‚æœå¯¹åå°„æœºåˆ¶æ²¡æœ‰ä¸€ä¸ªè®¤è¯†çš„è¯ï¼ŒåŠ¨æ€ä»£ç†éƒ¨åˆ†é€»è¾‘çš„å®ç°ä¼šæ¯”è¾ƒéš¾ç†è§£ï¼</p>\n</blockquote>\n<ul>\n<li><p>å®ç°æ€è·¯</p>\n<ol>\n<li>åˆ›å»ºå…¬å…±çˆ¶ç±»æˆ–æ¥å£ï¼Œä½¿ä»£ç†äººå’Œè¢«ä»£ç†äººå…·æœ‰å…¬å…±æ–¹æ³•</li>\n<li>è®¾è®¡ä»£ç†å·¥å‚ç±»ï¼Œæä¾›è·å–ä»£ç†å¯¹è±¡çš„æ–¹æ³•ã€‚æ–¹æ³•ä¸­ä¸»è¦åˆ©ç”¨Proxy.newProxyInstance()å»åˆ›å»ºä»£ç†å®ä¾‹ï¼Œå¹¶å®ç°å¯¹è¢«ä»£ç†ç±»åŠŸèƒ½çš„é‡å†™æˆ–æ‰©å±•</li>\n<li>åˆ›å»ºè¢«ä»£ç†å¯¹è±¡ï¼Œé€šè¿‡ä»£ç†å·¥å‚ç±»è·å–ä»£ç†å¯¹è±¡ï¼Œè°ƒç”¨ä»£ç†æ–¹æ³•ï¼Œå®Œæˆä»£ç†</li>\n</ol>\n</li>\n<li><p>ä»£ç éƒ¨åˆ†</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// Part.1</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">interface</span> <span class=\"title\">IUserDao</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">void</span> <span class=\"title\">run</span><span class=\"params\">()</span></span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Part.2</span></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ProxyFactory</span> </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> Object target;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">ProxyFactory</span><span class=\"params\">(Object target)</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">this</span>.target = target;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">getProxyInstance</span><span class=\"params\">()</span> </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> Proxy.newProxyInstance(</span><br><span class=\"line\">                <span class=\"comment\">// å‚æ•°1: loader</span></span><br><span class=\"line\">                <span class=\"comment\">// ä¸ºäº†è·å¾—åŸå¯¹è±¡çš„ç±»åŠ è½½å™¨</span></span><br><span class=\"line\">                target.getClass().getClassLoader(), </span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"comment\">// å‚æ•°2: interfaces</span></span><br><span class=\"line\">                <span class=\"comment\">// ä¸ºäº†è·å¾—åŸå¯¹è±¡æ‰€å®ç°çš„æ¥å£ç±»å‹</span></span><br><span class=\"line\">                target.getClass().getInterfaces(), </span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"comment\">// å‚æ•°3: new InvocationHandler</span></span><br><span class=\"line\">                <span class=\"comment\">// äº‹ä»¶å¤„ç†å™¨</span></span><br><span class=\"line\">                <span class=\"comment\">// æ‰§è¡Œç›®æ ‡å¯¹è±¡çš„æ–¹æ³•æ—¶,ä¼šè§¦å‘äº‹ä»¶å¤„ç†å™¨çš„æ–¹æ³•,ä¼šæŠŠå½“å‰æ‰§è¡Œç›®æ ‡å¯¹è±¡çš„æ–¹æ³•ä½œä¸ºå‚æ•°ä¼ å…¥</span></span><br><span class=\"line\">                <span class=\"keyword\">new</span> InvocationHandler() &#123;</span><br><span class=\"line\">                    </span><br><span class=\"line\">                    <span class=\"meta\">@Override</span></span><br><span class=\"line\">                    <span class=\"function\"><span class=\"keyword\">public</span> Object <span class=\"title\">invoke</span><span class=\"params\">(Object proxy, Method method, Object[] args)</span> <span class=\"keyword\">throws</span> Throwable </span>&#123;</span><br><span class=\"line\">                        System.out.println(<span class=\"string\">\"æ‰§è¡Œç›®æ ‡å¯¹è±¡çš„æ–¹æ³•å¹¶æ‰©å±•\"</span>);</span><br><span class=\"line\">                        Object returnValue = method.invoke(target, args);</span><br><span class=\"line\">                        System.out.println(<span class=\"string\">\"Propxy high up the speed to 20km/h! Fine!\"</span>);</span><br><span class=\"line\">                        <span class=\"keyword\">return</span> returnValue;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// Part.3</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">public</span> <span class=\"keyword\">static</span> <span class=\"keyword\">void</span> <span class=\"title\">main</span><span class=\"params\">(String[] args)</span> </span>&#123;</span><br><span class=\"line\">    UserDao target = <span class=\"keyword\">new</span> UserDao();</span><br><span class=\"line\">    System.out.println(target.getClass());</span><br><span class=\"line\">    </span><br><span class=\"line\">    IUserDao proxy = (IUserDao) <span class=\"keyword\">new</span> ProxyFactory(target).getProxyInstance();</span><br><span class=\"line\">    System.out.println(proxy.getClass());</span><br><span class=\"line\">    </span><br><span class=\"line\">    proxy.run();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ul>\n<p><br></p>\n<h3 id=\"Cglibä»£ç†ï¼ˆå­ç±»ä»£ç†ï¼‰\"><a href=\"#Cglibä»£ç†ï¼ˆå­ç±»ä»£ç†ï¼‰\" class=\"headerlink\" title=\"Cglibä»£ç†ï¼ˆå­ç±»ä»£ç†ï¼‰\"></a>Cglibä»£ç†ï¼ˆå­ç±»ä»£ç†ï¼‰</h3><ul>\n<li><a href=\"https://www.cnblogs.com/cenyu/p/6289209.html\" target=\"_blank\" rel=\"noopener\">è¯·è¿›å…¥ä¼ é€é—¨</a></li>\n</ul>\n<p><br></p>\n<blockquote>\n<p>  å‚è€ƒæ–‡çŒ®ï¼š<br>  [ 1 ] <a href=\"https://www.cnblogs.com/cenyu/p/6289209.html\" target=\"_blank\" rel=\"noopener\">https://www.cnblogs.com/cenyu/p/6289209.html</a><br>  [ 2 ] Javaæ ¸å¿ƒæŠ€æœ¯I p190-207<br><br></p>\n</blockquote>\n<p>ğŸ€From Clover <a href=\"https://aprilsx.github.io/2018/04/13/sprouting180413/\">https://aprilsx.github.io/2018/04/13/sprouting180413/</a> </p>\n","categories":[],"tags":[{"name":"sprouting","slug":"sprouting","count":17,"path":"api/tags/sprouting.json"}]}